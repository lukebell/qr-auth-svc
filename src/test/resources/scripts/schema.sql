DROP SCHEMA IF EXISTS AUTH CASCADE;

CREATE SCHEMA AUTH DEFAULT CHARACTER SET utf8;
SET DATABASE SQL SYNTAX MYS TRUE

CREATE TABLE AUTH.USER_CODES
(
  CLIENT_CODE BIGINT NOT NULL,
  TOKEN VARCHAR(30) NOT NULL,
  UUID VARCHAR(16) NOT NULL,
  CREATED_DATE TIMESTAMP DEFAULT NOW(),
  UNIQUE(TOKEN, CLIENT_CODE)
);

ALTER TABLE AUTH.USER_CODES ADD ID BIGINT UNIQUE NOT NULL GENERATED BY DEFAULT AS IDENTITY(START WITH 0, INCREMENT BY 1);
CREATE INDEX TOKEN_UC_IDX ON AUTH.USER_CODES (TOKEN ASC);
CREATE INDEX CLIENT_CODE_UC_IDX ON AUTH.USER_CODES (CLIENT_CODE ASC);
CREATE UNIQUE INDEX UUID_UC_IDX ON AUTH.USER_CODES (UUID ASC);

CREATE TABLE AUTH.CONFIG
(
  CLIENT_CODE VARCHAR(30) NOT NULL,
  AUTH_URL VARCHAR(255) NOT NULL,
  VALIDATE_URL VARCHAR (255)NOT NULL,
  SIZE DECIMAL(22,0) NOT NULL,
  TTL DECIMAL(22,0) NOT NULL,
  CREATED_BY BIGINT NOT NULL,
  CREATED_DATE TIMESTAMP DEFAULT NOW(),
  UNIQUE(CLIENT_CODE)
);

ALTER TABLE AUTH.CONFIG ADD ID BIGINT UNIQUE NOT NULL GENERATED BY DEFAULT AS IDENTITY(START WITH 0, INCREMENT BY 1);
CREATE INDEX CLIENT_CODE_CONFIG_IDX ON AUTH.CONFIG (CLIENT_CODE ASC);

CREATE TABLE AUTH.USER
(
  USERNAME VARCHAR(30) NOT NULL,
  FULL_NAME VARCHAR(255) NOT NULL,
  PASSWORD VARCHAR(255) NOT NULL,
  EMAIL VARCHAR (255)NOT NULL,
  ROLE DECIMAL(22,0) NOT NULL,
  CREATED_DATE TIMESTAMP DEFAULT NOW(),
  UNIQUE(USERNAME)
);

ALTER TABLE AUTH.USER ADD ID BIGINT UNIQUE NOT NULL GENERATED BY DEFAULT AS IDENTITY(START WITH 0, INCREMENT BY 1);
CREATE INDEX USERNAME_USER_IDX ON AUTH.USER (USERNAME ASC);
